language: cpp

env:
  matrix:
   - CMAKE_CXX_COMPILER=clang++-3.3
     CMAKE_BUILD_TYPE=DEBUG
     USE_TCMALLOC=TRUE
     BUILD_DOXYGEN=TRUE
   - CMAKE_CXX_COMPILER=g++-4.8
     CMAKE_BUILD_TYPE=DEBUG
     USE_TCMALLOC=TRUE
   - CMAKE_CXX_COMPILER=clang++-3.3
     CMAKE_BUILD_TYPE=RELEASE
     USE_TCMALLOC=TRUE
   - CMAKE_CXX_COMPILER=g++-4.8
     CMAKE_BUILD_TYPE=RELEASE
     USE_TCMALLOC=TRUE
   - CMAKE_CXX_COMPILER=clang++-3.3
     CMAKE_BUILD_TYPE=DEBUG
     USE_TCMALLOC=FALSE
   - CMAKE_CXX_COMPILER=g++-4.8
     CMAKE_BUILD_TYPE=DEBUG
     USE_TCMALLOC=FALSE
   - CMAKE_CXX_COMPILER=clang++-3.3
     CMAKE_BUILD_TYPE=RELEASE
     USE_TCMALLOC=FALSE
   - CMAKE_CXX_COMPILER=g++-4.8
     CMAKE_BUILD_TYPE=RELEASE
     USE_TCMALLOC=FALSE

before_script:
  - mkdir -p build
  - cd build
  - cmake -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER} ../src

script:
  - make
  - ctest -T test -VV
  - cd ..; if [[ $BUILD_DOXYGEN == TRUE ]]; then sudo apt-get -qq install doxygen graphviz; doxygen src/Doxyfile; COMMIT_LOG=`git log --oneline -n 1`; git config user.email "soonhok@cs.cmu.edu"; git config user.name "Soonho Kong"; git checkout -B gh-pages gh-pages; git add -A doc;  git commit -m "Update doxygen - $COMMIT_LOG"; git push origin gh-pages; git checkout master; fi

install:
  - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
  - sudo add-apt-repository --yes ppa:h-rayflood/llvm
  - sudo apt-get -qq update
  - if [[ $USE_TCMALLOC == TRUE ]]; then sudo add-apt-repository --yes ppa:agent-8131/ppa && sudo apt-get -qq update && sudo apt-get -qq install libgoogle-perftools-dev; fi
  - sudo apt-get -qq install libgmp-dev
  - sudo apt-get -qq install cmake
  - sudo apt-get -qq install libstdc++-4.8-dev
  - if [[ $CMAKE_CXX_COMPILER == g++-4.8 ]]; then sudo apt-get -qq install g++-4.8; fi
  - if [[ $CMAKE_CXX_COMPILER == clang++-3.3 ]]; then sudo apt-get -qq install clang-3.3; fi

notifications:
  email:
    recipients:
    - soonhok@cs.cmu.edu
    - leonardo@microsoft.com
    on_success: always
    on_failure: always
